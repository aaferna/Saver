<script>


    var myChart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
            labels: ['established', 'close', 'time_wait', 'listen', 'close_wait','unknown', 'syn_sent', 'syn_recv', 'last_ack', 'fin_wait1', 'fin_wait2'],
            datasets: [
            {
                label: '',
                fill: false,
                lineTension: 0.5,
                backgroundColor: 'rgba(75,192,192,1)',
                borderColor: 'rgba(0,0,0,1)',
                borderWidth: 2,
                data: [
                    0 ,
                    0 ,
                    0 ,
                    0 ,
                    0 ,
                    0 ,
                    0 ,
                    0 ,
                    0 ,
                    0 ,
                    0 
                ]
            }
            ]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    let data = select("Equipos", section[1])
    $("#name").text(data.nombre)

        setInterval(()=>{

            var settings = {
                "url": data.ip+"/usage/all",
                "method": "GET",
                "timeout": 0,
            };
            
            $.ajax(settings).done(function (response) {
                console.log(response.cpu)
                $("#cpuUsage").text(response.cpu+"%")
                $("#progress-bar").css('width',response.cpu+"%")

                $("#total").text(response.ram.total)
                $("#libre").text(response.ram.libre)
                $("#used").text(response.ram.used)
                $('#tbd > tbody:first').html(`<tr>
                
                <td>${response.networkState.established  }</td>
                <td>${response.networkState.close        }</td>
                <td>${response.networkState.time_wait    }</td>
                <td>${response.networkState.listen       }</td>
                <td>${response.networkState.close_wait   }</td>
                <td>${response.networkState.unknown      }</td>
                <td>${response.networkState.syn_sent     }</td>
                <td>${response.networkState.syn_recv     }</td>
                <td>${response.networkState.last_ack     }</td>
                <td>${response.networkState.fin_wait1    }</td>
                <td>${response.networkState.fin_wait2    }</td>
            
            </tr>`);

                myChart.data.datasets.pop()
                myChart.data.datasets.push({
                            label: '',
                            fill: false,
                            lineTension: 0.5,
                            backgroundColor: 'rgba(75,192,192,1)',
                            borderColor: 'rgba(0,0,0,1)',
                            borderWidth: 2,
                            data: [
                                response.networkState.established  ,
                                response.networkState.close        ,
                                response.networkState.time_wait    ,
                                response.networkState.listen       ,
                                response.networkState.close_wait   ,
                                response.networkState.unknown      ,
                                response.networkState.syn_sent     ,
                                response.networkState.syn_recv     ,
                                response.networkState.last_ack     ,
                                response.networkState.fin_wait1    ,
                                response.networkState.fin_wait2    
                            ]
                        })
                            
                        
                        
                myChart.update();


               

            });
        }, 5000)

</script>


<div class="col-lg-8 mx-auto p-3 py-md-5">

    <header class="d-flex align-items-center pb-3 mb-5"> 
        <a href="https://gusgeek.github.io/HealtyCenter/" class="d-flex align-items-center text-dark text-decoration-none">
        <span class="fs-4">Healty Center</span>
        </a>
    </header>

    <main>
        <div class="row g-5">
            <div class="col-sm-9">
            <h3 id="name"></h3>
            </div>
           
        </div>
        
        <hr class="col-3 col-md-2 mb-5" />
        <div class="row g-5" id="divActivity">

            <div class="col-xs-3 col-md-6 col-xl-3">
                <div class="card" >
                    <div class="card-body" style="height: 180px">
                        <h5 class="card-title">Uso de CPU</h5>
                        <br/>
                        <div class="progress">
                            <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <br/>
                        <p id="cpuUsage" class="card-text" style="font-size: 35px; text-align:center;">0%</p>
                    </div>
                </div>
            </div>

            <div class="col-xs-3 col-md-6 col-xl-6">
                <div class="card" >
                    <div class="card-body" style="height: 180px">
                        <h5 class="card-title">Uso de RAM</h5>
                        
                        <ul class="list-group list-group-flush">
                            <br>
                            <div class="row">
                                <div class="col-md-6 col-sm-6 ">
                                    <h5>Total</h5>
                                </div>
                                <div id="total" class="col-md-6 col-sm-6 text-end">
                                    0 MB
                                </div> 
                            </div>

                            <div class="row">
                                <div class="col-md-6 col-sm-6 ">
                                    <h5>Libre</h5>
                                </div>
                                <div id="libre" class="col-md-6 col-sm-6 text-end">
                                    0 MB
                                </div> 
                            </div>
                            <div class="row">
                                <div class="col-md-6 col-sm-6 ">
                                    <h5>Usado</h5>
                                </div>
                                <div id="used" class="col-md-6 col-sm-6 text-end">
                                    0 MB
                                </div> 
                            </div>

                        </ul>
                    </div>
                </div>
            </div>


            <div class="col-md-12">

            <h4>Estados de Red</h4>
            <hr class="col-3 col-md-2 mb-5" />
                <div class="table-responsive">
                    <table class="table table-sm table-bordered" id="tbd">
                        <thead >
                            <tr>
                            <th scope="col" style="font-size: 10px">ESTABLISHED</th>
                            <th scope="col" style="font-size: 10px">CLOSE</th>
                            <th scope="col" style="font-size: 10px">TIME_WAIT</th>
                            <th scope="col" style="font-size: 10px">LISTEN</th>
                            <th scope="col" style="font-size: 10px">CLOSE_WAIT</th>
                            <th scope="col" style="font-size: 10px">UNKNOWN</th>
                            <th scope="col" style="font-size: 10px">SYN_SENT</th>
                            <th scope="col" style="font-size: 10px">SYN_RECV</th>
                            <th scope="col" style="font-size: 10px">LAST_ACK</th>
                            <th scope="col" style="font-size: 10px">FIN_WAIT1</th>
                            <th scope="col" style="font-size: 10px">FIN_WAIT2</th>
                            </tr>
                        </thead>

                        <tbody >
                            
                        </tbody>
                    </table>
                </div>
            </div>

            <canvas id="myChart" width="400" height="150"></canvas>
           
        </div>


        </div>
    </main>
       
</div>


<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Nuevo Equipo</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
            <form >

                <div class="modal-body">
                    <div class="mb-3">
                        <label for="name" class="form-label">Nombre del Equipo</label>
                        <input type="text" class="form-control" id="name" />
                    </div>
                    <div class="mb-3">
                        <label for="ip" class="form-label">URL de Healty Deamon</label>
                        <input type="text" class="form-control" id="ip" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button  type="submit" class="btn btn-primary">Guardar</button>
                </div>

            </form>
        </div>
    </div>
</div>